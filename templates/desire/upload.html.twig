{% extends 'base.html.twig' %}


{% block title %}Wichtelrunde erstellen{% endblock %}

{% block body %}
        <div class="page-header">
            <div class="page-header-text">
                Lade Bilder hoch
            </div>
            <div class="page-header-image">
                <i class="fa-solid fa-upload fa-lg me-3 text-secondary"></i>
            </div>
        </div>

    <div class="container my-5">

        <!-- Informational Text -->
        <div class="text-center mb-4 bg-dark p-3 rounded">
            <p class="text-white fs-5 m-0">
                Lade hier Bilder oder Screenshots passend zu deinem Wunsch hoch. Wenn du einen Beispiel-Link angegeben hast, suchen wir für dich auf der Seite nach passenden Bildern und fügen eines hinzu.
            </p>
        </div>

        <!-- Action Buttons -->
        <div class="row mb-4">
            <div class="col-12 col-md-auto mb-3 mb-md-0">
                <a href="{{ path('app_desire_list', {'desireList': desireList.id}) }}" class="btn btn-outline-secondary w-100">
                    <i class="fa-solid fa-list me-2"></i> Zurück Wunschliste
                </a>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="bg-light p-4 rounded shadow-sm">
            {{ form_start(form) }}

            <!-- File Upload Input Group -->
            <div class="input-group mb-3">
                <div class="custom-file">
                    <label class="custom-file-label" for="{{ form.imageFile.vars.id }}">
                        <i class="fas fa-camera"></i> Bild hochladen
                    </label>
                    {{ form_widget(form.imageFile, {'attr': {'class': 'custom-file-input'}}) }}
                </div>
            </div>

            <!-- Image Preview -->
            <div id="image-preview" class="image-area"></div>

            <!-- Upload Button -->
            <div class="text-center">
                {{ form_widget(form.upload, {'attr': {'class': 'btn btn-success'}}) }}
            </div>

            {{ form_end(form) }}
        </div>

        <!-- Uploaded Images Section -->
        <div class="upload mt-5">
            <h2 class="text-center mb-4">Bereits hochgeladene Bilder</h2>
            <div class="image-container d-flex flex-wrap justify-content-center">
                {% for image in desire.images %}
                    <div class="image position-relative m-2" data-image-url="{{ path('app_desire_image_delete', {'desire': desire.id, 'image': image.id}) }}">
                        <img src="{{ image.cdnUrl }}" class="img-thumbnail" onclick="showLargeImage('{{ image.cdnUrl }}')">
                        <span class="delete-icon position-absolute top-0 end-0 translate-middle p-1 bg-danger rounded-circle" onclick="deleteImage(event)">
                            <i class="fas fa-trash text-white"></i>
                        </span>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Image Modal -->
        <div id="imageModal" class="modal">
            <span class="close" onclick="closeModal()">&times;</span>
            <img class="modal-content" id="img01">
        </div>
    </div>

    <script>
        function handleImagePreview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imagePreview = document.getElementById('image-preview');
                    imagePreview.innerHTML = `<img src="${e.target.result}" alt="Selected Image" class="img-thumbnail">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        const imageFileInput = document.querySelector('.custom-file-input');
        if (imageFileInput) {
            imageFileInput.addEventListener('change', function () {
                handleImagePreview(this);
            });
        }

        function showLargeImage(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('img01');
            modal.style.display = 'block';
            modalImg.src = imageSrc;
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }

        function deleteImage(event) {
            const imageContainer = event.target.closest('.image');
            const imageUrl = imageContainer.getAttribute('data-image-url');
            fetch(imageUrl, { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        imageContainer.remove();
                    } else {
                        console.error('Failed to delete image');
                    }
                })
                .catch(error => console.error('Error deleting image:', error));
        }
    </script>
{% endblock %}