<div{{ attributes }} class="container-fluid">
    <div class="card mb-3 {{ this.isListed }}">
        <!-- Card Header -->
        <div class="card-header bg-primary text-white d-flex flex-column desire-card-header">
            <!-- Name and Priority Buttons -->
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <!-- Image or Default Icon -->
                    {% if this.desire.images|length > 0 %}

                        <!-- Display First Image if Available -->
                        <img src="{{ this.desire.images[0].cdnUrl }}" class="rounded me-2" alt="Desire Image"
                             style="width: 40px; height: 40px; object-fit: cover;">
                    {% else %}
                        <!-- Default FontAwesome Icon -->
                        <i class="fa-solid fa-box fa-2x me-2 text-black"></i>
                    {% endif %}
                    <!-- Desire Name -->
                    <button class="btn btn-link text-white text-decoration-none p-0 clamp-text"
                            style="flex: 1; min-width: 0;"
                            type="button"
                            data-bs-toggle="collapse"
                            aria-expanded="false"
                            aria-controls="collapseDetails{{ this.desire.id }}"
                            data-bs-target="#collapseDetails{{ this.desire.id }}">
                        <h5 class="mb-2 clamp-text">{{ this.desire.name }}</h5>
                    </button>
                </div>

                <!-- Priority Button Group -->
                <div class="d-flex flex-column align-items-center ms-3 mt-4">
                    <!-- First Row: Action Form -->
                    <div>
                        {{ form_start(form, {
                            attr: {
                                'data-action': 'live#action:prevent',
                                'data-live-action-param': 'save'
                            }
                        }) }}
                        {{ form_row(form.priority, {
                            attr: {
                                'data-action': 'change->live#action',
                                'data-live-action-param': 'save',
                                'class': 'btn btn-secondary btn-sm'
                            }
                        }) }}
                        {{ form_end(form) }}
                    </div>

                    <!-- Second Row: Up and Down Buttons -->
                    <div class="btn-group mt-2">
                        <button data-action="click->live#action"
                                data-live-action-param="move"
                                data-live-direction-param="up"
                                class="btn btn-outline-light btn-sm {{ this.getDisableUp }}">
                            <i class="fa-solid fa-arrow-up {{ this.up }}"></i>
                        </button>
                        <button data-action="click->live#action"
                                data-live-action-param="move"
                                data-live-direction-param="down"
                                class="btn btn-outline-light btn-sm {{ this.getDisableDown }}">
                            <i class="fa-solid fa-arrow-down {{ this.down }}"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Icons (Left Upper Corner) -->
            <div class="d-flex align-items-center">
                <i class="fa-solid fa-fingerprint fa-lg {{ this.exactly }} me-3"></i>
                <i class="fa-solid fa-copy fa-lg {{ this.exclusive }} me-3"></i>
                <i class="fa-solid fa-eye fa-lg {{ this.active }} me-3"></i>
                {{ this.relationIcon()|raw }}
            </div>
        </div>

        <!-- Collapsible Details Section -->
        <div id="collapseDetails{{ this.desire.id }}" class="collapse">
            <div class="card-body">
                {% set realtionInfo = this.getRelationInfo %}
                {% if realtionInfo is not null %}
                    <h5 class="text-warning">{{ realtionInfo }}</h5>
                {% endif %}

                {% if this.isExactly() %}
                    <h5 class="text-danger">Du hast angegeben, dass du nur das Produkt aus dem Beispiel akzeptierst!</h5>
                {% endif %}

                <!-- Description -->
                <h5 class="mt-3">Beschreibung:</h5>
                <p>{{ this.desire.description }}</p>

                <!-- Image Section -->
                <div class="row mt-3">
                    {% for image in this.desire.images %}
                        <div class="col-6 col-sm-4 col-md-3">
                            <div role="button" onclick="showLargeImage('{{ image.cdnUrl }}')">
                                <img src="{{ image.cdnUrl }}" class="img-thumbnail" alt="Desire Image">
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- URLs -->
                {% for url in this.desire.urls %}
                    <p class="mt-2">
                        <a href="{{ url.path }}" target="_blank" class="btn btn-link">Beispiel</a>
                    </p>
                {% endfor %}
            </div>

            <!-- Card Footer -->
            <div class="card-footer">
                <!-- Action Buttons -->
                <div class="btn-group">
                    <a href="{{ path('app_desire_edit', {'desireList': this.desireList.id, 'desire': this.desire.id}) }}"
                       class="btn btn-secondary m-1">
                        <i class="fa-solid fa-pencil-alt"></i>
                    </a>
                    <a href="{{ path('app_upload_desire_image', {'desireList': this.desireList.id, 'desire': this.desire.id}) }}"
                       class="btn btn-secondary m-1">
                        <i class="fa-solid fa-camera"></i>
                    </a>
                    <a href="{{ path('app_extracted_desire_images', {'desireList': this.desireList.id, 'desire': this.desire.id}) }}"
                       class="btn btn-secondary m-1">
                        <i class="fa-solid fa-images"></i>
                    </a>
                    <a href="{{ path('app_desire_switch', {'from': this.desireList.id, 'desire': this.desire.id}, false) }}"
                       class="btn btn-secondary m-1">
                        <i class="fa-solid fa-shuffle"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
